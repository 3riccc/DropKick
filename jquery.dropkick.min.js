(function(f,j,l){var c={},o=[],i={left:37,up:38,right:39,down:40,enter:13},k=['<div class="dk_container" id="dk_container_{{ id }}" tabindex="{{ tabindex }}">','<a class="dk_toggle">','<span class="dk_label">{{ label }}</span>',"</a>",'<div class="dk_options">','<div class="dk_options_inner">',"</div>","</div>","</div>"].join("");optionTemplate='<li class="{{ current }}"><a data-dk-dropdown-value="{{ value }}">{{ text }}</a></li>',defaults={width:false,theme:false,change:false},keysBound=false;c.init=function(q){q=f.extend({},defaults,q);if(!keysBound){f(l).bind("keydown.dk_nav",function(t){var u=f(".dk_container.dk_open"),r=f(".dk_container.dk_focus"),s=null;if(u.length){s=u}else{if(r.length&&!u.length){s=r}}if(s){e(t,s.data("dropkick"))}}).bind("click",function(s){var r=f(s.target);if(f(".dk_container.dk_open").length){f(".dk_container.dk_open").removeClass("dk_open dk_focus")}});keysBound=true}return this.each(function(){var t=f(this),z=t.find(":selected").first(),x=t.find("option"),w=t.data("dropkick")||{},r=t.attr("id")||t.attr("name"),s=q.width||t.outerWidth(),u=t.attr("tabindex")?t.attr("tabindex"):"",y=false,v;if(w.id){return t}else{w.settings=q;w.tabindex=u;w.id=r;w.$original=z;w.$select=t;w.value=d(t.val())||d(z.attr("value"));w.label=z.text();w.options=x}y=a(k,w);y.find(".dk_toggle").css({width:s+"px"});t.hide().before(y);y=f("#dk_container_"+r);v=q.theme?q.theme:"default";y.addClass("dk_theme_"+v);w.theme=v;w.$dropdown=y;t.data("dropkick",w);y.data("dropkick",f.extend({},w,{isOpen:function(){return y.hasClass("dk_open")},isFocus:function(){return y.hasClass("dk_focus")},$toggle:y.find(".dk_toggle"),$label:y.find(".dk_label"),$inner:y.find(".dk_options_inner"),$current:function(){return y.find(".dk_option_current")},$options:y.find(".dk_options")}));o[o.length]=t;h(y.data("dropkick"))})};c.theme=function(t){var q=f(this),r=q.data("dropkick"),s=r.$dropdown;oldtheme="dk_theme_"+r.theme;s.removeClass(oldtheme).addClass("dk_theme_"+t);r.theme=t};c.reset=function(){for(var r=0,q=o.length;r<q;r++){var t=o[r].data("dropkick"),s=t.$dropdown.data("dropkick");s.$label.text(t.label);s.$inner.animate({scrollTop:0},0);g(s.$options.find("li").first(),s.$current(),s)}};f.fn.dropkick=function(q){if(c[q]){return c[q].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof q==="object"||!q){return c.init.apply(this,arguments)}}};function h(r){var q=r.$dropdown;r.$toggle.bind("click",function(s){m(r);s.preventDefault();return false});r.$options.find("a").live((f.browser.msie?"mousedown":"click"),function(t){var s=f(this);n(r);p(s,r);g(s.parent(),r.$current(),r);t.preventDefault();return false});q.bind("focus.dropkick",function(s){q.addClass("dk_focus")}).bind("blur.dropkick",function(s){q.removeClass("dk_open dk_focus")})}function e(u,w){var q=u.keyCode,y=w.$options,v=w.$current(),s=y.find("li").first(),x=y.find("li").last(),t,r;switch(q){case i.enter:if(w.isOpen()){p(w.$current().find("a"),w);n(w)}else{m(w)}u.preventDefault();break;case i.up:r=v.prev("li");if(w.isOpen()){if(r.length){g(r,v,w)}else{g(x,v,w)}}else{m(w)}u.preventDefault();break;case i.down:if(w.isOpen()){t=v.next("li").first();if(t.length){g(t,v,w)}else{g(s,v,w)}}else{m(w)}u.preventDefault();break;default:break}}function p(r,u){var s,q,t;s=r.attr("data-dk-dropdown-value");q=r.text();t=u.$dropdown;$select=u.$select;$select.val(s);u.$label.text(q);if(u.settings.change){u.settings.change.call($select,s,q)}}function g(r,q,t){var s=t.$dropdown;q.removeClass("dk_option_current");r.addClass("dk_option_current");b(t,r.prevAll("li"))}function b(s,r){var q=r.prevAll("li").outerHeight()*r.prevAll("li").length;s.$inner.animate({scrollTop:q+"px"},0)}function n(q){q.$dropdown.removeClass("dk_open")}function m(q){q.$dropdown.find(".dk_options").css({top:q.$toggle.outerHeight()-1});q.$dropdown.toggleClass("dk_open");b(q,q.$current())}function a(u,x){var y=u,z=[],w;y=y.replace("{{ id }}",x.id);y=y.replace("{{ label }}",x.label);y=y.replace("{{ tabindex }}",x.tabindex);if(x.options&&x.options.length){for(var s=0,r=x.options.length;s<r;s++){var q=f(x.options[s]),v="dk_option_current",t=optionTemplate;t=t.replace("{{ value }}",q.val());t=t.replace("{{ current }}",(d(q.val())===x.value)?v:"");t=t.replace("{{ text }}",q.text());z[z.length]=t}}w=f(y);w.find(".dk_options_inner").html(z.join(""));return w}function d(q){return(f.trim(q).length>0)?q:false}})(jQuery,window,document);