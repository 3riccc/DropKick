/*
 * DropKick 1.5
 *
 * Highly customizable <select> lists
 * https://github.com/robdel12/DropKick
 *
 * Created by: Jamie Lottering <http://github.com/JamieLottering> <http://twitter.com/JamieLottering>
 *
 *
*/(function(t,e,i){"use strict";var n=navigator.userAgent.match(/MSIE ([0-9]{1,}[\.0-9]{0,})/),a=!!n,d=a&&parseFloat(n[1])<7,o=navigator.userAgent.match(/iPad|iPhone|Android|IEMobile|BlackBerry/i),r=a?"mousedown":"click",l="onwheel"in e?"wheel":"onmousewheel"in i?"mousewheel":"MouseScrollEvent"in e&&"DOMMouseScroll MozMousePixelScroll",s={},p=[],c={left:37,up:38,right:39,down:40,enter:13,tab:9,zero:48,z:90,last:221},u=['<div class="dk_container" id="dk_container_{{ id }}" tabindex="{{ tabindex }}" aria-hidden="true">','<a class="dk_toggle dk_label">{{ label }}</a>','<div class="dk_options">','<ul class="dk_options_inner" role="main" aria-hidden="true">',"</ul>","</div>","</div>"].join(""),k='<li class="{{ current }}{{ disabled }}"><a data-dk-dropdown-value="{{ value }}">{{ text }}</a></li>',f='<li class="dk_optgroup{{ disabled }}"><span>{{ text }}</span>',h={startSpeed:400,theme:!1,changes:!1,syncReverse:!0,nativeMobile:!0,autoWidth:!0},g=null,_=null,v=function(t,e,i){var n=t.attr("data-dk-dropdown-value"),a=t.text(),d=e.data("dropkick"),o=d.$select;e.find(".dk_label").text(a?a:"&nbsp;"),i?o.val(n):o.val(n).trigger("change"),d.settings.change&&!i&&!d.settings.syncReverse&&d.settings.change.call(o,n,a)},b=function(t){t.removeClass("dk_open dk_open_top"),g=null},m=function(i){if(i.data("dropkick").settings.fixedMove)return"up"==i.data("dropkick").settings.fixedMove?!1:!0;var n=i.find(".dk_toggle"),a=i.find(".dk_options").outerHeight(),d=t(e).height()-n.outerHeight()-n.offset().top+t(e).scrollTop(),o=n.offset().top-t(e).scrollTop();return o>a?d>a:!0},C=function(t,e,i){var n=t.find(".dk_options_inner"),a=e.prevAll("li").outerHeight()*e.prevAll("li").length+(e.closest(".dk_optgroup",n).length&&e.closest(".dk_optgroup",n).prevAll("li").outerHeight()*e.closest(".dk_optgroup",n).prevAll("li").length),d=n.scrollTop(),o=n.height()+n.scrollTop()-e.outerHeight();(i&&"keydown"===i.type||d>a||a>o)&&n.scrollTop(a)},w=function(t,e){var i=m(t),n="dk_open"+(i?"":" dk_open_top");t.find(".dk_options").css({top:i?t.find(".dk_toggle").outerHeight()-1:"",bottom:i?"":t.find(".dk_toggle").outerHeight()-1}),g=t.addClass(n),C(t,t.find(".dk_option_current"),e)},x=function(t,e,i){e.find(".dk_option_current").removeClass("dk_option_current"),t.addClass("dk_option_current"),C(e,t,i)},$=function(e,i){var n,a,d,o,r,l,s,p=e.keyCode,u=i.data("dropkick"),k=String.fromCharCode(p),f=i.find(".dk_options"),h=i.hasClass("dk_open"),g=f.find("li:not(.disabled)"),_=i.find(".dk_option_current"),m=_.closest(".dk_optgroup",f),C=g.first().hasClass("dk_optgroup")?g.first().find("li:not(.disabled)").first():g.first(),$=g.last().hasClass("dk_optgroup")?g.last().find("li:not(.disabled)").last():g.last();switch(p){case c.enter:h?_.hasClass("disabled")||(v(_.find("a"),i),b(i)):w(i,e),e.preventDefault();break;case c.tab:h&&(_.length&&v(_.find("a"),i),b(i));break;case c.up:h?(a=_.prevAll("li:not(.disabled)").first(),a.hasClass("dk_optgroup")&&(a=a.find("li:not(.disabled)").last()),!a.length&&m.length&&(a=m.prevAll("li:not(.disabled)").first().hasClass("dk_optgroup")?m.prevAll("li:not(.disabled)").first().find("li:not(.disabled)").last():m.prevAll("li:not(.disabled)").first()),x(a.length?a:$,i,e)):w(i,e),e.preventDefault();break;case c.down:h?(n=_.nextAll("li:not(.disabled)").first(),n.hasClass("dk_optgroup")&&(n=n.find("li:not(.disabled)").first()),!n.length&&m.length&&(n=m.nextAll("li:not(.disabled)").first().hasClass("dk_optgroup")?m.nextAll("li:not(.disabled)").first().find("li:not(.disabled)").first():m.nextAll("li:not(.disabled)").first()),x(n.length?n:C,i,e)):w(i,e),e.preventDefault()}if(p>=c.zero&&p<=c.z){for(d=(new Date).getTime(),null===u.finder||void 0===u.finder?(u.finder=k.toUpperCase(),u.timer=d):d>parseInt(u.timer,10)+1e3?(u.finder=k.toUpperCase(),u.timer=d):(u.finder=u.finder+k.toUpperCase(),u.timer=d),o=g.find("a"),r=0,l=o.length;l>r;r++)if(s=t(o[r]),0===s.html().toUpperCase().indexOf(u.finder)&&!s.closest(".dk_optgroup",f).hasClass("disabled")){v(s,i),x(s.parent(),i,e);break}i.data("dropkick",u)}},A=function(e){return t.trim(e).length>0?e:!1},y=function(e,i){var n,a,d,o,r,l=function(e){return k.replace("{{ value }}",e.val()).replace("{{ current }}",A(e.val())===i.value?"dk_option_current":"").replace("{{ disabled }}",void 0!==e.attr("disabled")?"disabled":"").replace("{{ text }}",t.trim(e.html())?t.trim(e.html()):"&nbsp;")},s=e.replace("{{ id }}",i.id).replace("{{ label }}",i.label).replace("{{ tabindex }}",i.tabindex),p=[];if(i.options&&i.options.length)for(a=0,d=i.options.length;d>a;a++){if(o=t(i.options[a]),o.is("option"))r=0===a&&void 0!==o.attr("selected")&&void 0!==o.attr("disabled")?null:l(o);else if(o.is("optgroup")){if(r=f.replace("{{ text }}",o.attr("label")||"---").replace("{{ disabled }}",void 0!==o.attr("disabled")?" disabled":""),t(i.options[a]).children().length){r+="<ul>";for(var c=0,u=t(i.options[a]).children().length;u>c;c++){var h=t(i.options[a]).children().eq(c);r+=l(h)}r+="</ul>"}r+="</li>"}p[p.length]=r}return n=t(s),n.find(".dk_options_inner").html(p.join("")),n};d||(i.documentElement.className=i.documentElement.className+" dk_fouc"),s.init=function(e){return e=t.extend({},h,e),u=e.dropdownTemplate?e.dropdownTemplate:u,k=e.optionTemplate?e.optionTemplate:k,this.each(function(){var i,n,a=t(this),d=a.find(":selected").first(),r=a.children(),l=a.data("dropkick")||{},s=a.attr("id")||a.attr("name"),c=a.parent(".dk_wrap"),k=e.width||c.length?c.width()-(a.innerWidth()-a.width()):a.outerWidth(),f=a.attr("tabindex")||"0",h=!!a.attr("disabled"),g=!1;return l.id?a:(l.settings=e,l.tabindex=f,l.id=s,l.$original=d,l.$select=a,l.value=A(a.val())||A(d.attr("value")),l.label=d.text()?d.text():"&nbsp;",l.options=r,l.theme=e.theme||"default",g=y(u,l),l.settings.autoWidth&&g.find(".dk_toggle").css({width:k+"px"}),h&&g.attr({disabled:"disabled",tabindex:-1}),a.before(g).appendTo(g.addClass("dk_theme_"+i)),c.length?(c.removeClass("dk_wrap"),g.show()):g.fadeIn(e.startSpeed),l.$dk=g,a.data("dropkick",l),g.addClass(a.attr("class")),g.data("dropkick",l),p[p.length]=a,g.on({"focus.dropkick":function(){_=!g.attr("disabled")&&g.addClass("dk_focus")},"blur.dropkick":function(){g.removeClass("dk_focus"),_=null}}),o&&l.settings.nativeMobile&&g.addClass("dk_mobile"),l.settings.syncReverse&&a.on("change",function(e){var i=a.val(),n=t('a[data-dk-dropdown-value="'+i+'"]',g),d=n.text();g.find(".dk_label").text(d?d:"&nbsp;"),x(n.parent(),g,e),l.settings.change&&l.settings.change.call(a,i,d)}),n=a.attr("form")?t("#"+a.attr("form").replace(" ",", #")):a.closest("form"),void(n.length&&n.on("reset",function(){a.dropkick("reset")})))})},s.theme=function(e){var i=t(this).data("dropkick"),n=i.$dk,a="dk_theme_"+i.theme;i.theme=e||i.theme,n.removeClass(a).addClass("dk_theme_"+e)},s.reset=function(e){return this.each(function(){var i=t(this).data("dropkick"),n=i.$dk,a=t('a[data-dk-dropdown-value="'+i.$original.attr("value")+'"]',n);i.$original.prop("selected",!0),x(a.parent(),n),v(a,n,!e)})},s.setValue=function(e){return this.each(function(){var i=t(this).data("dropkick").$dk,n=t('.dk_options a[data-dk-dropdown-value="'+e+'"]',i);n.length&&v(n,i)|x(n.parent(),i)})},s.refresh=function(e){return this.each(function(){var i,n,a=t(this).data("dropkick"),d=a.$select,o=a.$dk;a.options=d.children(),n=y(u,a).find(".dk_options_inner"),o.find(".dk_options_inner").replaceWith(n),a.$original.parent().length||(a.$original=d.find(":selected").first(),a.label=a.$original.text()),i=t('a[data-dk-dropdown-value="'+d.val()+'"]',o),x(i.parent(),o),v(i,o,!e)})},s.destroy=function(){return this.each(function(){var e=t(this).data("dropkick");e.$dk.before(function(){return e.$select.removeData("dropkick")}).remove()})},s.clone=function(e,i,n){var a=[];t.each(this,function(d){var o=t(this).data("dropkick"),r=o.settings,l=o.$select.clone();r.autoWidth&&(r.width=o.$dk.find(".dk_label").width()),i&&l.attr({id:i}),n&&l.attr({name:n}),l.removeData("dropkick"),0==e?a[d]=l[0]:(l.dropkick(r),a[d]=l.data("dropkick").$dk[0])})},s.disable=function(e){return this.each(function(){var i=t(this).data("dropkick"),n=i.$select,a=i.$dk;0==e?(n.removeAttr("disabled"),a.removeAttr("disabled").attr({tabindex:i.tabindex})):(a.hasClass("dk_open")&&b(a),n.attr({disabled:"disabled"}),a.attr({disabled:"disabled",tabindex:-1}))})},t.fn.dropkick=function(t){if(!d){if(s[t])return s[t].apply(this,Array.prototype.slice.call(arguments,1));if("object"==typeof t||!t)return s.init.apply(this,arguments)}},t(function(){t(i).on(r,".dk_options a",function(){var e=t(this),i=e.parent(),n=e.parents(".dk_container").first();return i.hasClass("disabled")||i.closest(".dk_optgroup",n).hasClass("disabled")||(i.hasClass("dk_option_current")||(v(e,n),x(e.parent(),n)),b(n)),!1}).on(l,".dk_options_inner",function(t){var e=t.originalEvent.wheelDelta||-t.originalEvent.deltaY||-t.originalEvent.detail;return a?(this.scrollTop-=Math.round(e/10),!1):e>0&&this.scrollTop<=0||0>e&&this.scrollTop>=this.scrollHeight-this.offsetHeight?!1:!0}).on({"keydown.dk_nav":function(t){var e=g||_;e&&$(t,e)},click:function(e){var i,n=t(e.target);if(g&&0===n.closest(".dk_container").length)b(g);else{if(n.is(".dk_toggle, .dk_label"))return i=n.parents(".dk_container").first(),i.hasClass("dk_open")?b(i):(g&&b(g),!i.attr("disabled")&&w(i,e)),!1;n.attr("for")&&t("#dk_container_"+n.attr("for"))[0]&&t("#dk_container_"+n.attr("for")).trigger("focus.dropkick")}}})})})(jQuery,window,document);